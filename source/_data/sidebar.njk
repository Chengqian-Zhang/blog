
{% macro render(name, itemName, value) %}

  {%- set itemURL = value.split('||')[0] | trim %}
  {%- if not itemURL.startsWith('http') %}
    {%- set itemURL = itemURL | replace('//', '/') %}
  {%- endif %}
  <li class="menu-item dp-left-menu-item menu-item-{{ itemName | replace(' ', '-') }}">

    {%- set menuIcon = '<i class="' + value.split('||')[1] | trim + ' fa-fw"></i>' if theme.menu_settings.icons and value.split('||')[1] else '' %}
    {%- set menuText = __('menu.' + name) | replace('menu.', '') %}

    {%- set menuBadge = '' %}

    {{- next_url(itemURL, menuIcon + menuText + menuBadge, {rel: 'section'}) -}}

  </li>

{% endmacro %}

{%- if theme.menu and is_page() %}
  {# Submenu & Submenu-2 #}
  {%- for name, value in theme.menu %}
    {%- set respath = value %}
    {%- if value == '[object Object]' %}

      {# If current URL is value of parent submenu 'default' path #}
      {%- set currentParentUrl = page.path.split('/')[0] | trim %}
      {%- if currentParentUrl == value.default.split('||')[0] | trim | replace('/', '') %}

        {# Submenu items #}
        <ul class="sub-menu menu dp-left-menu dp-sub1">
        {%- for subname, subvalue in value %}
          {# For main submenu items #}
          {%- if subvalue != '[object Object]' %}
            {%- set itemName = subname | lower %}
            {%- if itemName == 'default' %}
              {%- set parentValue = subvalue.split('||')[0] | trim %}
            {% else %}
              {%- set respath = subvalue if subvalue.startsWith('http') else (parentValue + subvalue) %}
              {{ render(subname, itemName, respath) }}
            {%- endif %}
          {% else %}
            {# For 'default' submenu item in main submenu #}
            {%- set itemName = subname | lower %}
            {%- for subname2, subvalue2 in subvalue %}
              {%- if subname2 == 'default' %}
                {%- set respath = parentValue + subvalue2 %}
                {{ render(subname, itemName, respath) }}
              {%- endif %}
            {%- endfor %}
            {%- set paths = page.path.split('/') %}
            {%- if paths.length > 2 %}
              {%- if paths[1] == subvalue.default.split('||')[0] | trim | replace('/', '') %}

                  {# Submenu-2 items #}
                  <ul class="sub-menu menu dp-left-menu dp-sub2">
                  {%- for subname2, subvalue2 in subvalue %}
                    {%- set respath2 = subvalue %}
                    {%- set itemName = subname2 | lower %}
                    {%- if itemName == 'default' %}
                      {%- set parentSubValue = subvalue2.split('||')[0] | trim %}
                    {% else %}
                      {%- if subvalue2.startsWith('http') %}
                        {%- set respath2 = subvalue2 %}
                      {% else %}
                        {%- set respath2 = parentValue + parentSubValue + subvalue2 %}
                      {%- endif %}
                      {{ render(subname2, itemName, respath2) }}
                    {%- endif %}
                  {%- endfor %}
                  </ul>
                  {# End Submenu-2 items #}

              {%- endif %}
            {%- endif %}


          {%- endif %}
        {%- endfor %}
        </ul>
        {# End Submenu items #}

      {%- endif %}
      {# End URL & path comparing #}

    {%- endif %}
  {%- endfor %}
  {# End Submenu & Submenu-2 #}
{%- endif %}
